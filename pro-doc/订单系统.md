# **蜂产品官网订单系统PRD（精简版）**

## **1. 核心目标**

- **简化流程**：仅支持单商家、单仓库模式（无需拆单），降低开发复杂度。
- **核心功能闭环**：覆盖用户下单→支付→发货→售后全流程。
- **低成本实现**：优先使用第三方服务（如微信支付、快递鸟API），减少自研模块。

---

## **2. 功能需求精简清单**

### **2.1 核心功能**

| 模块         | 功能描述                                                                 | 是否必须 |
|--------------|--------------------------------------------------------------------------|----------|
| **订单创建** | 用户选择商品、填写地址、选择支付方式，生成预订单                        | ✅        |
| **支付对接** | 集成微信支付/支付宝，支持支付成功回调                                   | ✅        |
| **订单管理** | 商家后台可查看待发货订单，批量导出运单                                  | ✅        |
| **物流跟踪** | 用户端展示物流状态（集成快递鸟API）                                     | ✅        |
| **售后申请** | 用户提交退货申请，商家后台审核并处理退款                                | ✅        |

### **2.2 可舍弃的复杂功能**

- **拆单逻辑**：所有商品统一从同一仓库发货，无需拆单。
- **优惠叠加计算**：仅支持单一优惠券或满减活动（避免规则复杂化）。
- **高并发处理**：日均订单量<1000，无需Redis库存锁，直接使用数据库事务防超卖。

---

## **3. 极简业务流程**

### **3.1 用户下单流程**

1. **提交订单**  
   - 用户选择商品→填写地址→提交订单（前端校验库存）。
   - 生成预订单，状态为“待支付”，库存预扣减（锁定10分钟）。
2. **支付**  
   - 跳转微信支付，支付成功后回调系统，状态变更为“待发货”。
   - 支付超时（10分钟）自动取消订单，释放库存。
3. **发货**  
   - 商家后台导出订单，手动填写物流单号后，状态变更为“已发货”。
   - 自动同步物流信息至用户端（调用快递鸟API）。
4. **完成**  
   - 用户收货后7天自动变“已完成”，或手动确认收货。

### **3.2 售后流程**
1. **用户申请退款**  
   - 仅支持整单退货，无需处理部分退款。
   - 待发货：直接取消订单并退款。  
   - 已发货：用户寄回商品，商家确认后手动退款。
2. **商家处理**  
   - 后台审核退货申请，手动操作退款（通过支付原路返回）。

---

## **4. 技术方案简化**
### **4.1 技术栈选择**
| 模块         | 方案                                                                   | 理由                          |
|--------------|------------------------------------------------------------------------|-------------------------------|
| **后端框架** | Spring Boot（单体架构） / PHP Laravel                                 | 快速开发，无需微服务          |
| **数据库**   | MySQL（主库） + 本地缓存（Ehcache）                                   | 避免Redis运维成本             |
| **支付对接** | 微信支付官方SDK                                                       | 直接调用，无需自研支付逻辑    |
| **物流对接** | 快递鸟免费API（物流查询+电子面单）                                    | 免费基础功能够用              |
| **部署**     | 单台云服务器（2核4G） + 基础版MySQL云数据库                           | 低运维成本                    |

### **4.2 关键性能妥协**
- **库存防超卖**：直接使用数据库事务（`SELECT FOR UPDATE`），牺牲部分并发性能，但足够支撑小规模场景。
- **订单状态同步**：支付回调成功后，可能延迟1~3秒更新状态，用户容忍度较高。
- **物流信息更新**：每天定时拉取一次物流状态（非实时），减少API调用次数。

---

## **5. 极简数据模型**
### **5.1 核心数据表（3张表搞定）**
#### **订单表（order）**
| 字段          | 类型       | 说明                           |
|---------------|------------|--------------------------------|
| id            | BIGINT     | 自增主键                      |
| order_no      | VARCHAR(20)| 订单号（年月日+4位随机数）     |
| status        | TINYINT    | 状态：0待支付，1待发货，2已发货，3已完成，4已取消 |
| total_amount  | DECIMAL    | 总金额（含运费）               |
| address       | TEXT       | 收货地址（JSON存储姓名、电话、地址） |
| logistics_no  | VARCHAR(50)| 物流单号（商家后台填写）        |

#### **订单商品表（order_item）**
| 字段       | 类型      | 说明               |
|------------|-----------|--------------------|
| order_id   | BIGINT    | 关联订单ID         |
| product_id | BIGINT    | 商品ID             |
| quantity   | INT       | 购买数量           |

#### **库存表（inventory）**
| 字段       | 类型      | 说明               |
|------------|-----------|--------------------|
| product_id | BIGINT    | 商品ID（唯一索引） |
| stock      | INT       | 当前库存           |

---

## **6. 开发优先级建议**
1. **第一阶段（MVP版本）**  
   - 实现订单创建、支付回调、商家后台发货功能（2周）。
2. **第二阶段（用户体验优化）**  
   - 增加物流状态查询、售后申请入口（1周）。
3. **第三阶段（扩展性）**  
   - 基础促销功能（满100减10）、库存预警邮件通知（可选）。

---

## **7. 推荐替代方案（更低成本）**
如果开发资源极其有限，可考虑：
1. **开源系统二次开发**  
   - 使用 [WooCommerce（WordPress插件）](https://woocommerce.com/) 或 [Shopify](https://www.shopify.com/)，仅定制蜂产品主题。
2. **SAAS工具**  
   - 直接使用 [有赞微小店](https://www.youzan.com/) 或 [微盟](https://www.weimob.com/)，年费约3000元，无需开发。

---

通过此精简方案，开发周期可控制在**1个月内**（1名全栈工程师），重点保障核心交易链路，放弃非必要功能，后续再根据业务增长逐步迭代。